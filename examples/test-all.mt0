<% "Running all examples" :: newl

start = now()
this = File@filename(get_launch_args()[0])
root = new: File("examples")

if (!root.exists() || !root.is_dir()) ?
	die("Failed to open examples directory")

title = func: char, str => "", width => 50 {
	pad = char.repeat((width - str.size()) / 2 - 2)
	space = str.is_empty() ? "" : " "
	title = pad :: space :: str :: space :: pad
	if ((n = width - title.size()) > 0)
		title[] = char.repeat(n)

	return: title
}

tmp = new: File("")
count = 0
root.for_each(func: file, %tmp, %count {
	tmp.set(file)
	if (tmp.extension() != ".mt0" || tmp.filename() == #this) ?
		void!

	<% newl :: title("v", file)
	time = measure_time(load(file))
	<% title("^", "Finished in {} secs".format(time / 1000.0)) :: newl
	++count
})
<% $"Done running examples ({} in total). {} secs elapsed." count, (now() - start) / 1000.0